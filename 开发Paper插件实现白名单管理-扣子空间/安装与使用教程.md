# Paper白名单管理插件 - 安装与使用教程

## 一、插件介绍
Paper白名单管理插件是一个为Minecraft Paper服务端设计的网页端白名单管理系统，支持玩家通过网页提交白名单申请，管理员在线审批，并自动同步到游戏服务端。

### 主要功能
- 网页端白名单申请（支持Java版、手机版及双版本）
- 管理员后台审批管理
- 白名单列表维护与编辑
- 自动执行服务端白名单命令
- 本地H2数据库存储数据

## 二、安装准备
- Minecraft Paper服务端（1.18+版本推荐）
- Java 11或更高版本
- 服务器开放指定的Web端口（默认为8080）

## 三、安装步骤

### 1. 下载插件
从发布页面下载最新版本的`PaperWhitelistPlugin.jar`文件。

### 2. 安装插件
将下载的jar文件放入服务器的`plugins`文件夹中。

### 3. 首次启动服务器
启动服务器，插件会自动生成配置文件和数据文件夹。启动完成后关闭服务器，进行配置修改。

### 4. 配置插件
编辑`plugins/PaperWhitelistPlugin/config.yml`文件：

```yaml
# Web服务器设置
web:
  port: 8080  # 修改为你想要使用的端口
  bind-address: "0.0.0.0"  # 绑定地址，默认所有接口
  session-timeout: 30  # 会话超时时间(分钟)

# 管理员设置
admin:
  password-hash: ""  # 留空将使用默认密码
  default-password: "admin123"  # 首次使用的默认密码，请登录后立即修改

# 白名单设置
whitelist:
  bedrock-prefix: "BE_"  # 手机版ID前缀
  default-user-type: "TRIAL"  # 默认用户类型(TRIAL/MEMBER)
```

### 5. 生成管理员密码哈希（推荐）
启动服务器后，在游戏内或控制台执行以下命令生成密码哈希：
```
/whitelistweb hash 你的密码
```
将生成的哈希值复制到`config.yml`的`admin.password-hash`字段，并删除`default-password`或设置为空。

### 6. 重启服务器
重启服务器使配置生效。

## 四、使用指南

### 玩家申请白名单
1. 打开浏览器，访问服务器IP:端口（如http://你的服务器IP:8080）
2. 点击"申请白名单"
3. 填写游戏ID、QQ联系方式
4. 选择版本（Java版、手机版或两者都有）
5. 提交申请，等待管理员审批

### 管理员操作
1. 访问http://你的服务器IP:8080/login
2. 使用配置的管理员密码登录
3. 在申请管理页面处理待审批申请：
   - 点击"通过"批准申请并添加到白名单
   - 点击"拒绝"拒绝申请
4. 在白名单管理页面管理已添加的白名单：
   - 点击"编辑"修改玩家信息
   - 点击"删除"从白名单移除玩家

### 插件命令
在游戏内或控制台可执行以下命令：
- `/whitelistweb reload` - 重新加载配置文件
- `/whitelistweb hash <密码>` - 生成密码哈希
- `/whitelistweb status` - 显示插件状态信息
- `/whitelistweb help` - 显示帮助信息

## 五、常见问题解决

### 1. 无法访问网页界面
- 检查服务器防火墙是否开放了配置的Web端口
- 确认插件是否正常加载（查看服务器日志）
- 检查配置文件中的`bind-address`是否设置为"0.0.0.0"（允许外部访问）

### 2. 白名单添加后游戏内仍无法进入
- 确认服务器已启用白名单（`/whitelist on`）
- 检查游戏ID是否正确，区分大小写
- 查看服务器日志是否有白名单命令执行记录

### 3. 管理员密码忘记
- 停止服务器
- 编辑`config.yml`，删除`password-hash`字段或设置为空
- 设置`default-password`为新密码
- 启动服务器，使用默认密码登录后立即更新密码

## 六、注意事项
- 首次使用后请立即修改默认密码
- 定期备份`plugins/PaperWhitelistPlugin/whitelist.db`数据库文件
- 确保服务器有稳定的网络连接（获取UUID需要联网）
- 不要将Web端口设置为与Minecraft服务器端口相同

## 七、更新日志
### v1.0.0
- 初始版本发布
- 支持网页端白名单申请与管理
- 支持Java版/手机版双版本
- 本地H2数据库存储